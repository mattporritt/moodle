define ("core_course/copy_modal",["jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification"],function(a,b,c,d,f,g,h){var l={},m,n,o,p="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>";function i(){b.get_string("loading").then(function(a){c.create({type:c.types.DEFAULT,title:a,body:p,large:!0}).done(function(a){o=a;o.getRoot().on("click","#id_submitreturn",k);o.getRoot().on("click","#id_submitdisplay",function(a){a.formredirect=!0;k(a)});o.getRoot().on("click","#id_cancel",function(a){a.preventDefault();o.setBody(p);o.hide()})})}).catch(function(){h.exception(new Error("Failed to load string: loading"))})}function j(a){if("undefined"==typeof a){a={}}var c={jsonformdata:JSON.stringify(a),courseid:n.id};o.setBody(p);b.get_string("copycoursetitle","backup",n.shortname).then(function(a){o.setTitle(a);o.setBody(g.loadFragment("course","new_base_form",m,c))}).catch(function(){h.exception(new Error("Failed to load string: copycoursetitle"))})}function k(b){b.preventDefault();window.console.log(b.formredirect);var c=o.getRoot().find("form").serialize(),d=JSON.stringify(c),e=a.merge(o.getRoot().find("[aria-invalid=\"true\"]"),o.getRoot().find(".error"));if(e.length){e.first().focus();return}f.call([{methodname:"core_backup_submit_copy_form",args:{jsonformdata:d}}])[0].done(function(){o.setBody(p);o.hide();if(!0==b.formredirect){var a=new URL(window.location),c=a.origin+"/backup/copyprogress.php?id="+n.id;window.location.assign(c)}}).fail(function(){j(c)})}l.init=function(b){m=b;i();a(".action-copy").on("click",function(a){a.preventDefault();var b=new URL(this.getAttribute("href")),c=new URLSearchParams(b.search),d=c.get("id");f.call([{methodname:"core_course_get_courses",args:{options:{ids:[d]}}}])[0].done(function(a){n=a[0];j()}).fail(function(){h.exception(new Error("Failed to load course"))});o.show()})};return l});
//# sourceMappingURL=copy_modal.min.js.map
