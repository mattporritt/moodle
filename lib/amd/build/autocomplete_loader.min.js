define("core/autocomplete_loader",["exports","core/autocomplete","./str","core/notification","core/pending"],(function(_exports,_autocomplete,_str,_notification,_pending){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_autocomplete=_interopRequireDefault(_autocomplete),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending);var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const fetchSearch=async function(query){let method=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"core_search_autocomplete";const Ajax=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/ajax"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/ajax")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/ajax"])),request=await Ajax.call([{methodname:method,args:{query:query}}])[0];return request.results};_exports.init=(selector,placeholder,paginationConfig)=>{let currentResults,limits={min:1,max:paginationConfig};const autoCompleteJS=new _autocomplete.default({selector:"#"+selector,searchEngine:"strict",data:{src:fetchSearch,keys:["title","settingname","settingvisiblename","settingdescription"],cache:!1,filter:list=>Array.from(new Set(list.map((value=>value.match)))).map((settingname=>list.find((value=>value.match===settingname))))},placeHolder:placeholder,resultsList:{id:"autoComplete_list",position:"afterbegin",element:async(list,data)=>{if(data.results.length)list.style["overflow-y"]="scroll",currentResults=data,limits.min=1,limits.max=data.results.length,await addPagination(list);else{const info=document.createElement("div");info.setAttribute("class","no_result"),list.style["overflow-y"]="hidden",info.innerHTML=await(0,_str.get_string)("noresultsfound","search",'"'.concat(data.query,'"')),list.append(info)}},destination:"#autoCompleteResult",noResults:!0,maxResults:paginationConfig,tabSelect:!0},resultItem:{element:(item,data)=>{item.style="display: flex; justify-content: space-between; cursor: pointer;",item.setAttribute("onclick","location.href='"+data.value.url+"'");let icon="settingname"===data.key?"fa-gear":"fa-bars";item.innerHTML='\n                  <span style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">\n                    <i class="fa '.concat(icon,'"></i> ').concat(data.match,'\n                    <i class="fa fa-arrow-up-right-from-square"></i>\n                  </span>')},highlight:!0},events:{input:{focus:()=>{autoCompleteJS.input.value.length>2&&autoCompleteJS.start()}}}}),redrawAutocompleteResults=container=>{const pendingPromise=new _pending.default("core/datafilter:addFilterRow");container.innerHTML="",currentResults.matches.entries().forEach((_ref=>{let[index,data]=_ref;if(index>=limits.min-1&&index<=limits.max-1){const resultitem=document.createElement("li");resultitem.style="display: flex; justify-content: space-between; cursor: pointer;",resultitem.setAttribute("id","autoComplete_result_"+(index-1)),resultitem.setAttribute("role","option"),resultitem.setAttribute("onclick","location.href='"+data.value.url+"'");let icon="settingname"===data.key?"fa-gear":"fa-bars";resultitem.innerHTML='\n                  <span style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">\n                    <i class="fa '.concat(icon,'"></i> ').concat(data.match,'\n                    <i class="fa fa-arrow-up-right-from-square"></i>\n                  </span>'),container.append(resultitem)}})),addPagination(container).then((result=>(pendingPromise.resolve(),result))).catch(_notification.default.exception)},addPagination=async element=>{const createAndAppendElement=function(tag){let attributes=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},innerHTML=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const element=document.createElement(tag);return Object.entries(attributes).forEach((_ref2=>{let[key,value]=_ref2;element.setAttribute(key,value)})),element.innerHTML=innerHTML,element},pag=createAndAppendElement("div",{class:"d-flex justify-content-between"});pag.onclick=ev=>{ev.stopPropagation()};const prev=createAndAppendElement("span",{class:"icon fa fa-left-long p-1 ml-2",style:"cursor:pointer"});prev.onclick=ev=>{((ev,container)=>{limits.min>1&&(limits.max=limits.max===currentResults.matches.length?limits.max-(limits.max-limits.min+1):limits.max-autoCompleteJS.resultsList.maxResults,limits.min=limits.min-autoCompleteJS.resultsList.maxResults,redrawAutocompleteResults(container)),ev.stopPropagation()})(ev,element)},limits.min<=1&&(prev.style.visibility="hidden"),pag.append(prev);let searchResultParams={link:currentResults.results[0].value.rooturl},searchResult=await(0,_str.get_string)("autocompletesearchresult","search",searchResultParams);const stats=createAndAppendElement("p",{class:"text-muted small p-1 m-0",id:"autoComplete_stats"},"".concat(limits.min,"-").concat(limits.max," / ").concat(currentResults.matches.length," - ").concat(searchResult));pag.append(stats);const next=createAndAppendElement("span",{class:"icon fa fa-right-long p-1 mr-2",style:"cursor:pointer"});next.onclick=ev=>{ev.preventDefault(),((ev,container)=>{if(limits.max<currentResults.matches.length){const exceedMax=limits.max+autoCompleteJS.resultsList.maxResults>currentResults.matches.length;limits.min=limits.min+autoCompleteJS.resultsList.maxResults,limits.max=exceedMax?currentResults.matches.length:limits.max+autoCompleteJS.resultsList.maxResults,redrawAutocompleteResults(container)}ev.stopPropagation()})(ev,element)},limits.max===currentResults.matches.length&&(next.style.visibility="hidden"),pag.append(next),element.append(pag)}}}));

//# sourceMappingURL=autocomplete_loader.min.js.map