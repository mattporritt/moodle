define("tiny_aiplacement/generateimage",["exports","core/modal_events","tiny_aiplacement/imagemodal","core/ajax","core/str","core/templates","./mediaimage","tiny_aiplacement/options","tiny_aiplacement/generatebase"],(function(_exports,_modal_events,_imagemodal,_ajax,_str,_templates,_mediaimage,_options,_generatebase){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal_events=_interopRequireDefault(_modal_events),_imagemodal=_interopRequireDefault(_imagemodal),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_mediaimage=_interopRequireDefault(_mediaimage),_generatebase=_interopRequireDefault(_generatebase);class GenerateImage extends _generatebase.default{constructor(editor){super(editor),_defineProperty(this,"setupModal",(async()=>{const modalObject=await _imagemodal.default.create(GenerateImage.modalConfig);return(await modalObject.getRoot()).on(_modal_events.default.hidden,(()=>{modalObject.destroy()})),modalObject})),_defineProperty(this,"setupContentModal",(async(modalObject,templateContext)=>{const[loadingBody,imageBody,imageFooter]=await Promise.all([_templates.default.render("tiny_aiplacement/loading",templateContext),_templates.default.render("tiny_aiplacement/modalbodyimage",templateContext),_templates.default.render("tiny_aiplacement/modalfooterimage",templateContext)]);modalObject.setBody(loadingBody+imageBody),modalObject.setFooter(imageFooter),this.addContentEventListeners(modalObject)})),_defineProperty(this,"handleContentModalClick",((e,modalObject,root)=>{const actions={generate:()=>this.handleSubmit(root,e.target),inserter:()=>this.handleInsert(modalObject),cancel:()=>modalObject.destroy()},actionKey=Object.keys(actions).find((key=>e.target.closest('[data-action="'.concat(key,'"]'))));actionKey&&(e.preventDefault(),actions[actionKey]())})),_defineProperty(this,"setupPromptArea",(root=>{const generateBtn=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_generatebutton")),promptArea=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_imageprompt"));promptArea.addEventListener("input",(()=>{generateBtn.disabled=""===promptArea.value.trim()}))})),_defineProperty(this,"handleSubmit",(async(root,submitBtn)=>{await this.displayLoading(root,submitBtn);const request={methodname:"aiplacement_tinymce_generate_image",args:this.getDisplayArgs(root)};try{this.responseObj=await _ajax.default.call([request])[0],this.responseObj.error?this.handleGenerationError(root,submitBtn):(await this.displayGeneratedImage(root),this.hideLoading(root,submitBtn),window.console.log(this.responseObj))}catch(error){this.handleGenerationError(root,submitBtn)}})),_defineProperty(this,"handleInsert",(async modalObject=>{const mediaImage=new _mediaimage.default(this.editor,this.imageURL);mediaImage.loadPreviewImage(this.imageURL),await mediaImage.displayDialogue(),modalObject.destroy()})),_defineProperty(this,"handleGenerationError",(async(root,submitBtn)=>{const imageContainer=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_generate_image")),faImage=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_fa_image")),faImageText=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_fa_image_text"));imageContainer.classList.add("alert-danger"),faImage.classList.add("fa-ban"),faImage.classList.remove("fa-image"),faImageText.innerHTML=await(0,_str.getString)("errorgenimage","tiny_aiplacement"),this.hideLoading(root,submitBtn)})),_defineProperty(this,"displayGeneratedImage",(async root=>{const imageDisplayContainer=root.querySelector("#".concat(this.editor.id,"_image_display_container")),insertBtn=root.querySelector('[data-action="inserter"]');this.imageURL=this.responseObj.drafturl,imageDisplayContainer.innerHTML=await _templates.default.render("tiny_aiplacement/image",{url:this.responseObj.drafturl,elementid:this.editor.id});const imagelement=root.querySelector("#".concat(this.editor.id,"_tiny_generated_image"));return new Promise(((resolve,reject)=>{imagelement.onload=()=>{insertBtn.classList.remove("hidden"),resolve()},imagelement.onerror=error=>{reject(error)}}))})),_defineProperty(this,"getDisplayArgs",(root=>{const contextId=(0,_options.getContextId)(this.editor),promptText=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_imageprompt")).value,imageQualitySwitchId="".concat(this.editor.id,"_image_quality_switch"),imageStyleSwitchId="".concat(this.editor.id,"_image_style_switch");return{contextid:contextId,prompttext:promptText,aspectratio:this.getSelectedRadioValue("aspect-ratio","square"),quality:this.getCheckboxValue(imageQualitySwitchId,!1)?"hd":"standard",numimages:1,style:this.getCheckboxValue(imageStyleSwitchId,!1)?"vivid":"natural"}})),_defineProperty(this,"getCheckboxValue",(function(checkboxId){let defaultValue=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const checkbox=document.getElementById(checkboxId);return checkbox?checkbox.checked:defaultValue})),_defineProperty(this,"getSelectedRadioValue",(function(radioName){let defaultValue=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const radios=document.getElementsByName(radioName);for(const radio of radios)if(radio.checked)return radio.value;return defaultValue})),this.imageURL=null}}return _exports.default=GenerateImage,_defineProperty(GenerateImage,"modalConfig",{type:_imagemodal.default.TYPE,xlarge:!0}),_exports.default}));

//# sourceMappingURL=generateimage.min.js.map