define("tiny_aiplacement/generatebase",["exports","tiny_aiplacement/loading","core/str","core/templates","tiny_aiplacement/options","core/ai/policy"],(function(_exports,_loading,_str,_templates,_options,_policy){var obj;function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};return _exports.default=class{constructor(editor){var _this=this;_defineProperty(this,"displayContentModal",(async()=>{const templateContext=this.getTemplateContext(),modalObject=await this.setupModal();await modalObject.show();(await(0,_policy.getPolicyStatus)(this.userid,this.contextid)).status?await this.setupContentModal(modalObject,templateContext):await this.setupPolicyModal(modalObject,templateContext)})),_defineProperty(this,"addContentEventListeners",(async modalObject=>{const root=(await modalObject.getRoot())[0];root.addEventListener("click",(e=>{this.handleContentModalClick(e,modalObject,root)})),this.setupPromptArea(root),this.hideLoadingSpinner(root)})),_defineProperty(this,"setupPolicyModal",(async(modalObject,templateContext)=>{const loadingContext={...templateContext,ishidden:!0},[loadingBody,policyBody,policyFooter]=await Promise.all([_templates.default.render("tiny_aiplacement/loading",loadingContext),_templates.default.render("tiny_aiplacement/modalbodypolicy",templateContext),_templates.default.render("tiny_aiplacement/modalfooterpolicy",templateContext)]);modalObject.setBody(loadingBody+policyBody),modalObject.setFooter(policyFooter),this.addPolicyEventListeners(modalObject)})),_defineProperty(this,"hideLoadingSpinner",(root=>{const loadingSpinnerDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_spinner"));loadingSpinnerDiv.classList.add("hidden"),loadingSpinnerDiv.classList.remove("tiny-aiplacement-loading-spinner-container")})),_defineProperty(this,"addPolicyEventListeners",(async modalObject=>{(await modalObject.getRoot())[0].addEventListener("click",(e=>{this.handlePolicyModalClick(e,modalObject)}))})),_defineProperty(this,"handlePolicyModalClick",((e,modalObject)=>{const actions={accept:()=>this.handlePolicyAccept(modalObject,e.target),cancel:()=>modalObject.destroy()},actionKey=Object.keys(actions).find((key=>e.target.closest('[data-action="'.concat(key,'"]'))));actionKey&&(e.preventDefault(),actions[actionKey]())})),_defineProperty(this,"handlePolicyAccept",(async(modalObject,acceptBtn)=>{await(0,_policy.setPolicyStatus)(this.userid,this.contextid);const root=(await modalObject.getRoot())[0];await this.displayLoading(root,acceptBtn,"tiny-aiplacement-loading-spinner-container");const templateContext=this.getTemplateContext();await this.setupContentModal(modalObject,templateContext),await this.hideLoading(root,acceptBtn)})),_defineProperty(this,"getTemplateContext",(()=>({elementid:this.editor.id}))),_defineProperty(this,"displayLoading",(async function(root,submitBtn){let removeClass=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const loadingSpinnerDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_spinner")),overlayDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_overlay")),blurDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_blur")),loadingTextDiv=root.querySelector("#".concat(_this.editor.id,"_tiny_aiplacement_loading_text"));(0,_loading.loadingMessages)(loadingTextDiv),removeClass&&loadingSpinnerDiv.classList.remove(removeClass),loadingSpinnerDiv.classList.remove("hidden"),overlayDiv.classList.remove("hidden"),blurDiv.classList.add("tiny-aiplacement-blur"),submitBtn.innerHTML=await(0,_str.getString)("generating","tiny_aiplacement"),submitBtn.disabled=!0})),_defineProperty(this,"hideLoading",(async(root,submitBtn)=>{const loadingSpinnerDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_spinner")),overlayDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_overlay")),blurDiv=root.querySelector("#".concat(this.editor.id,"_tiny_aiplacement_blur"));loadingSpinnerDiv.classList.add("hidden"),overlayDiv.classList.add("hidden"),blurDiv.classList.remove("tiny-aiplacement-blur"),submitBtn.innerHTML=await(0,_str.getString)("regenerate","tiny_aiplacement"),submitBtn.disabled=!1})),this.editor=editor,this.userid=(0,_options.getUserId)(editor),this.contextid=(0,_options.getContextId)(editor),this.responseObj=null}},_exports.default}));

//# sourceMappingURL=generatebase.min.js.map